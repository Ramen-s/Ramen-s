<% title = @selected_genre ? "#{@selected_genre.name}一覧" : "商品一覧" %>

<div style="max-width:1100px; margin:0 auto; padding:24px 16px;">
  <div style="display:flex; gap:28px; align-items:flex-start;">

    <!-- 左：ジャンル検索（枠付き） -->
    <aside style="width:220px;">
      <div style="border:1px solid #000;">
        <div style="padding:10px 12px; border-bottom:1px solid #000; font-weight:600; text-align:center;">
          ジャンル検索
        </div>
        <div style="padding:10px 12px;">
          <ul class="genre-box__list">
            <% @genres.each do |genre| %>
              <li>
                <%= link_to genre.name, items_path(genre_id: genre.id) %>
              </li>
            <% end %>
          </ul>
        </div>
      </div>
    </aside>

    <!-- 右：商品一覧 -->
    <main style="flex:1;">
      <h1 style="margin:0 0 14px 0;">
        <%= title %> <span style="font-size:14px; font-weight:400;">（全<%= @items_count %>件）</span>
      </h1>

      <div style="display:grid; grid-template-columns:repeat(4, minmax(0, 1fr)); gap:18px;">
        <% @items.each do |item| %>
          <div>
            <!-- 画像 -->
            <div style="border:1px solid #ddd; background:#f3f3f3; height:120px; display:flex; align-items:center; justify-content:center; overflow:hidden;">
              <% if item.image.attached? %>
                <%= image_tag item.image, style: "width:100%; height:100%; object-fit:cover; display:block;" %>
              <% else %>
                <div style="color:#777; font-size:12px;">No Image</div>
              <% end %>
            </div>

            <div style="margin-top:8px;">
              <%= link_to item.name, item_path(item), style: "color:#000; text-decoration:none;" %>
            </div>

            <div style="margin-top:4px; font-weight:600;">
              ¥<%= item.price %>
            </div>
          </div>
        <% end %>
      </div>

      <!-- ページネーション（自前：1ページ8件） -->
      <div style="margin-top:22px; text-align:center;">
        <% qp = {} %>
        <% qp[:genre_id] = @selected_genre.id if @selected_genre.present? %>

        <% if @total_pages > 1 %>
          <%# First / Prev %>
          <% if @page > 1 %>
            <%= link_to "First", items_path(qp.merge(page: 1)), style: "margin:0 6px;" %>
            <%= link_to "Prev",  items_path(qp.merge(page: @page - 1)), style: "margin:0 6px;" %>
          <% end %>

          <%# number links（最大5個だけ表示：現在の周辺） %>
          <% start_page = [@page - 2, 1].max %>
          <% end_page   = [start_page + 4, @total_pages].min %>
          <% start_page = [end_page - 4, 1].max %>

          <% (start_page..end_page).each do |p| %>
            <% if p == @page %>
              <span style="margin:0 6px; font-weight:700;"><%= p %></span>
            <% else %>
              <%= link_to p, items_path(qp.merge(page: p)), style: "margin:0 6px;" %>
            <% end %>
          <% end %>

          <%# Next / Last %>
          <% if @page < @total_pages %>
            <%= link_to "Next", items_path(qp.merge(page: @page + 1)), style: "margin:0 6px;" %>
            <%= link_to "Last", items_path(qp.merge(page: @total_pages)), style: "margin:0 6px;" %>
          <% end %>
        <% end %>
      </div>
    </main>

  </div>
</div>